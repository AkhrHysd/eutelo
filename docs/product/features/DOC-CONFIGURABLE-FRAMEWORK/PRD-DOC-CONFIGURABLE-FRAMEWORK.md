---
id: PRD-EUTELO-CONFIGURABLE-FRAMEWORK
type: prd
feature: EUTELO-CONFIGURABLE-FRAMEWORK
title: Eutelo Configurable Framework 機能 PRD
purpose: >
  スキャフォールドのディレクトリ構成・フロントマター定義・Guard に利用する LLM プロンプトを
  コア実装から切り離し、各プロジェクトが容易にカスタマイズできるようにすることで、
  あらゆるドキュメント文化・開発スタイルにフィットするドキュメントフレームワークに進化させる。
status: draft
version: 0.1
parent: PRD-EUTELO-CORE
owners: ["@林田晃洋"]
tags: ["eutelo", "guard", "config", "framework"]
last_updated: "2025-11-17"
---

# PRD-EUTELO-CONFIGURABLE-FRAMEWORK

## 1. Background

現状の Eutelo / Doc-Guard 系機能では、以下のような要素が実装側に「ほぼハードコーディング」されている想定である。

1. スキャフォールド時に生成される **ディレクトリ構成・ファイルパス**
   - 例: `docs/product/features/{FEATURE}/PRD-...` 固定
2. 各ドキュメント種別の **フロントマター構成**
   - 必須フィールド（`id`, `type`, `feature`, `purpose`, `parent`, …）
   - 命名規則や enum 的な値
3. Doc-Guard / Eutelo-Guard で利用する **LLM 向けプロンプト**
   - purpose 整合チェック用プロンプト
   - 階層ルール、命名ルールの説明
   - エラー・警告メッセージのフォーマット

この状態だと：

- 利用プロジェクトごとのドキュメント文化（命名規則・階層構造・必須フィールド）が異なる場合に、
  **Eutelo 側の実装をフォーク／改造しないと適用できない**。
- 「どんなプロダクトにも適用できるドキュメントフレームワーク」というビジョンに反し、
  一部の組織に最適化された「専用ツール」に閉じてしまうリスクがある。
- Guard のプロンプト文面が固定されているため、
  プロジェクト側のガバナンス・トーン＆マナーに揃えたエラー文面やルール説明をしづらい。

そこで、**ディレクトリ構成、フロントマター定義、Guard 用プロンプトを外部化し、設定可能にする**ことが必要である。


## 2. Goals / KPI

### Goals

- Eutelo / Doc-Guard を **「どのプロダクトでも使えるフレームワーク」** として位置づけ直すため、
  コアロジックとプロジェクト固有ルールを分離する。
- 各プロジェクトが **設定ファイルやテンプレートの編集だけで** 自身のルールを反映できるようにする。
- Guard の LLM プロンプトも外部化し、プロジェクトごとに **チェック粒度・メッセージ・ルール説明** を調整可能にする。

### KPI（暫定）

- 既存の Dento/Eutelo プロジェクト以外に、**最低 2 つ以上の別プロジェクトで導入できる柔軟性** を持つこと。
- 「ディレクトリ構成を変えたい／フロントマターを変えたい」要求の 80% 以上が、
  **コード改修なしに設定ファイルの変更のみで完結**すること。
- Guard のプロンプトカスタマイズにより、**エラー／警告メッセージのプロジェクト独自化**（文面・基準）が可能であること。
- 既存プロジェクトに対しては **非互換な変更無し**（デフォルト設定で現状と同じ挙動）であること。


## 3. Scope

### In Scope

- スキャフォールド機能の「構造定義」の外部化
  - ディレクトリ／ファイルパスの雛形を設定ファイル（例: YAML/JSON）として定義
  - テンプレート中の変数（`{FEATURE}`, `{DATE}`, `{OWNER}` など）の定義・マッピング
- ドキュメント種別ごとのフロントマター定義の外部化
  - 種別（`prd`, `beh`, `dsg`, `adr`, `task`, `ops` など）ごとに必須フィールド・型を記述
  - Guard がこの定義を読み取り、**静的チェック**（存在・型・enum）を実行
- Guard 用 LLM プロンプトの外部化
  - LLM に渡す「ルール説明」「入力形式」「出力フォーマット」のテンプレート化
  - プロジェクトごとの差し替え・上書き
- 設定ファイルの階層構造
  - コアデフォルト
  - プロジェクトルートの `eutelo.config.*`（仮）
  - 必要なら機能別オーバーライド（例: `docs/product/features/{FEATURE}/eutelo.feature.config.*`）
- CLI からの設定参照方法
  - `eutelo scaffold` / `eutelo guard` が共通の設定リゾルバを通じて挙動を決定する

### Out of Scope（今回やらないもの）

- 設定編集用の **GUI（Web UI / VSCode 拡張）** の提供
- 「プラグインマーケットプレイス」レベルの複雑なプラグイン機構
  - 今回はまず「設定ファイル・テンプレートの外部化」に絞る
- LLM モデル選定ロジックの高度な設定（複数モデルの自動切り替えなど）
- 完全なマルチテナント SaaS としての「ホスト型 Eutelo」提供


## 4. Requirements

### 4.1 Functional Requirements (FR)

#### FR-1: 設定ファイルによるディレクトリ構成の定義

- `eutelo.config.(yaml|json|ts)` などの設定ファイルで、スキャフォールドすべき構造を宣言的に定義できること。
- 例（イメージ）:

  ```yaml
  scaffold:
    features:
      prd:
        path: "docs/product/features/{FEATURE}/PRD-{FEATURE}.md"
        template: "@dox-kit/templates/prd-default.md"
      beh:
        path: "docs/product/features/{FEATURE}/BEH-{FEATURE}.md"
        template: "@dox-kit/templates/beh-default.md"
  ```

- CLI `eutelo scaffold feature AUTH` などを実行した際、この設定に基づいてファイルが生成されること。

#### FR-2: フロントマター定義の外部化と静的バリデーション

- 各ドキュメント種別ごとに、フロントマターのスキーマを設定ファイルで定義できること。
  - フィールド名、型（string/number/array/enum/date 等）、必須/任意
  - 例: `type` は `["prd", "beh", "dsg", ...]` の enum など
- Guard の静的チェックは、この設定を読み込んでフロントマターを検証する。
  - 未定義フィールドの警告
  - 必須フィールド欠落のエラー
  - 型・enum 不一致のエラー

#### FR-3: Guard 用 LLM プロンプトの外部化

- LLM に渡すプロンプトテンプレートを、設定ファイルまたはテンプレートファイルとして外部化する。
  - `guard.prompts.purposeConsistency`, `guard.prompts.parentConsistency` 等のキーで管理
- プロジェクト側でこれを上書きすることで、以下を変更できること。
  - ルールの説明文
  - 違反時のメッセージ方針
  - 出力フォーマットの微調整（ただし Guard 実装が解釈可能な範囲）

#### FR-4: 設定の探索・マージ戦略

- 設定は以下のレイヤでマージされること。
  1. ライブラリ同梱の **デフォルト設定**
  2. プロジェクトルートの設定ファイル
  3. 任意で、対象ディレクトリに近い `eutelo.local.config.*` のようなローカルオーバーライド
- 上書きルールは「下位レベルが優先」だが、**型・スキーマが破綻しないよう最低限の検証**を行う。

#### FR-5: 後方互換性の確保

- 設定ファイルが存在しない既存プロジェクトでも、現在の Eutelo / Doc-Guard が動作している構成と同等の挙動を維持する。
- 設定ファイルを導入しても、最低限のマイグレーションで移行できるよう、
  「現在のハードコーディング情報をデフォルト設定としてそのまま取り出す」方針とする。

#### FR-6: DX 支援

- `eutelo config init` のようなコマンドで、デフォルト設定をプロジェクトに書き出せること。
- 設定ファイルのスキーマ（型定義）を公開し、IDE 補完や型チェックが効くようにする。（例: TypeScript 定義を配布）

---

### 4.2 Non-Functional Requirements (NFR)

- **NFR-1: パフォーマンス**
  - Guard 実行時の設定ロード／マージにより、実行時間が顕著に悪化しないこと。
  - 設定はキャッシュし、同一プロセス内で繰り返し読む場合は再パースを避ける。

- **NFR-2: 安定性 / 透明性**
  - 設定ファイルに誤りがある場合、明確なエラーメッセージで通知する。
  - 設定によって挙動が変わる箇所は、`--debug` オプション等で「どの設定が効いているか」を可視化できること。

- **NFR-3: セキュリティ**
  - Guard プロンプトの外部化により、LLM 経由で意図しない情報が流出しないよう、
    プロジェクト側ガイドラインを README などで提示する。
  - 設定ファイルの場所・パスの解決は、安全なルールに限定（任意パスの読み込みはしない）。

- **NFR-4: ドキュメント**
  - 本機能について、Eutelo/dox-kit 自身のドキュメント（PRD/DSG/README）で説明されていること。
  - 外部プロジェクトが自分たちのルールを記述するための **「設定例」** を複数提供する。

---

## 5. Risks & Trade-offs

- 設定可能な範囲を広げすぎると、コア側のテストパターンが爆発し、メンテナンスコストが増大する。
  - → 最初の段階では「ディレクトリ・フロントマター・プロンプト」に絞り、
    それ以外のルール（例えば CI の実行順や詳細な LLM モデル選択）は後続の PRD で扱う。
- プロジェクトごとにあまりに違う構造を許容すると、Eutelo/dox-kit 自体の「ベストプラクティス」としての価値が薄れる可能性。
  - → デフォルト設定を「推奨スタイル」として強く位置づけた上で、
    カスタマイズは「それでも違う作法を持つ組織向けの escape hatch」とする。

---

## 6. Open Questions

- 設定ファイルのフォーマットは何を第 1 候補とするか？
  - YAML / JSON / TypeScript（`defineConfig` 的）など。
- Guard プロンプトの外部化の粒度をどこまで許容するか？
  - 1 つの巨大プロンプトを丸ごと差し替えるか、
    セクションごとにブロック置換するか。
- 設定を「パッケージ」として配布できるようにするか？
  - 例: `@org/eutelo-config-enterprise` のようなプリセットを npm として配布する仕組み。

---

## 7. Next Steps

- DSG: `DSG-EUTELO-CONFIGURABLE-FRAMEWORK` を追加し、
  - 設定スキーマ（型定義）
  - コンフィグリゾルバ設計
  - Guard / Scaffold 各機能との接続方法
  を設計する。
- Task 群:
  - 既存ハードコーディングの棚卸し
  - デフォルト設定ファイルへの切り出し
  - 設定リゾルバ実装
  - Guard / Scaffold の設定対応
  - 既存リポジトリへの移行ガイド作成
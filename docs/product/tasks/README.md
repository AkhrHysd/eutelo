# 🧰 Tasks ガイド

このディレクトリは、PRD・BEH・DSG・ADR を起点にした  
**実装・検証・運用タスク** を管理します。  

目的は、機能の目的（PRD）と観察可能な振る舞い（BEH）を  
**テストファースト（Red→Green→Refactor）** で満たし、  
AI・人間いずれの開発者も安全かつ再現可能な単位で作業できるようにすることです。

---

## 構成

```
tasks/
  README.md
  _template-task.md
  TSK-{FEATURE}.md
```

- 各 `TSK-{FEATURE}.md` は 1機能単位のタスク束（Epic 相当）。  
- 必要に応じて `Subtasks` セクションで分割（階層は1段まで）。

---

## 運用ルール

- **出発点はBEH**：対象PRDに紐づく BEHシナリオ を選定し、まず再現テストを作成する（テストファースト）。
- **TDD準拠**：タスクは **Red → Green → Refactor** の順で進める。  
  実装はGreenに必要な最小限に留める。
- **観察可能性**：各タスクは **達成条件（Acceptance Criteria）** を明文化し、BEHシナリオIDと対応付ける。
- **完了の定義（DoD）**：テスト・ドキュメント・運用手順を含め、完了条件を明示する。
- **粒度の基準**：  
  - Pull Request 差分（+/-） ≦ **300行**  
  - 影響ファイル数 ≦ **5〜7**  
  - 対応する BEHシナリオ数 ≦ **3件**  
  - 一貫した目的で説明できるスコープ  
  → これを超える場合は Subtasks に分割し、依存関係を明示する。
- **依存関係の明示**：ブロッカー・外部依存は `Dependencies` または `Risks` に記載。
- **状態遷移**：`status` は  
  `todo | red | green | refactor | review | done | blocked | dropped` を使用。
- **更新トラッキング**：`last_updated` を毎回更新。主要な変更は `CHANGELOG.md` にも反映。

---

## 推奨ライフサイクル（TDDベース）

1. **BEHシナリオ選定**（PRD準拠）  
2. **Red**：失敗するテストを先に書く（手動／自動いずれも可）  
3. **Green**：最小実装でテストを通す  
4. **Refactor**：重複・命名・責務を整理（テストは常にグリーン維持）  
5. **レビュー**（技術／QA／運用）  
6. **DoD確認→done** ／ 必要に応じて ADR・DSG・BEH を更新  

---

## チェックリスト（最小）

- [ ] 対応する PRD / BEH / DSG / ADR へのリンクがある  
- [ ] Acceptance Criteria が検証可能な表現になっている  
- [ ] DoD にテスト／ドキュメント／運用反映が含まれる  
- [ ] リスクと依存関係が明記されている  
- [ ] PR 差分が 300 行以内、ファイル数が 7 以下  
- [ ] Red→Green→Refactor の痕跡（テスト履歴やログ）が残っている  

---

> **目的:**  
> タスクは「作業の一覧」ではなく、**BEHで定義された体験を再現するためのテスト駆動の証跡**である。  
> この階層では、設計と実装の間を透明に接続し、AI・人間が協調できる開発単位を提供する。